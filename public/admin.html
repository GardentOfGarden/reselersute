<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ECLIPSE | Reseller Panel</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="container">
        <!-- Login Screen -->
        <div id="loginBox" class="login-container">
            <div class="login-box">
                <div class="logo">
                    <i class="fas fa-fire"></i>
                    <h1>ECLIPSE</h1>
                </div>
                <p class="subtitle">Reseller Admin Panel</p>
                <div class="input-group">
                    <input type="password" id="adminPass" placeholder="Enter password">
                    <button id="loginBtn">Login</button>
                </div>
                <p id="loginMsg"></p>
            </div>
        </div>

        <!-- Main Panel -->
        <div id="panelBox" class="main-panel hidden">
            <!-- Sidebar -->
            <div class="sidebar">
                <div class="sidebar-header">
                    <i class="fas fa-fire"></i>
                    <h2>ECLIPSE</h2>
                </div>
                <nav class="sidebar-nav">
                    <div class="nav-section">
                        <h3>Dashboard</h3>
                        <a href="#" class="nav-item active" onclick="showSection('dashboard')">
                            <i class="fas fa-key"></i>
                            License Keys
                        </a>
                    </div>
                    <div class="nav-section">
                        <h3>Management</h3>
                        <a href="#" class="nav-item" onclick="showSection('banned')">
                            <i class="fas fa-ban"></i>
                            Banned Keys
                        </a>
                    </div>
                    <div class="nav-section">
                        <h3>Settings</h3>
                        <a href="#" class="nav-item" onclick="showSection('settings')">
                            <i class="fas fa-cog"></i>
                            Settings
                        </a>
                        <a href="#" class="nav-item" onclick="logout()">
                            <i class="fas fa-sign-out-alt"></i>
                            Logout
                        </a>
                    </div>
                </nav>
            </div>

            <!-- Main Content -->
            <div class="main-content">
                <!-- Header -->
                <header class="content-header">
                    <h1>Dashboard</h1>
                    <div class="header-actions">
                        <div class="user-info">
                            <span>Admin</span>
                            <i class="fas fa-user-shield"></i>
                        </div>
                    </div>
                </header>

                <!-- Generate Key Section -->
                <div class="card">
                    <h2>Key Generator</h2>
                    <div class="generate-form">
                        <label>Duration:</label>
                        <select id="durationSelect">
                            <option value="3600000">1 Hour</option>
                            <option value="86400000">1 Day</option>
                            <option value="604800000">1 Week</option>
                            <option value="2592000000">1 Month</option>
                            <option value="31536000000">1 Year</option>
                        </select>
                        <button id="generateBtn" class="btn-primary">
                            <i class="fas fa-bolt"></i>
                            Generate Key
                        </button>
                    </div>
                    <div id="genMsg" class="generated-key hidden">
                        <h4>Generated Key:</h4>
                        <code id="generatedKeyText"></code>
                        <button id="copyKeyBtn" class="btn-secondary">
                            <i class="fas fa-copy"></i>
                            Copy
                        </button>
                    </div>
                </div>

                <!-- Keys List -->
                <div class="card">
                    <div class="card-header">
                        <h2>All Keys</h2>
                        <button class="btn-secondary" onclick="loadKeys()">
                            <i class="fas fa-sync-alt"></i>
                            Refresh
                        </button>
                    </div>
                    <div class="keys-list">
                        <ul id="keysList"></ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const loginBox = document.getElementById("loginBox");
        const panelBox = document.getElementById("panelBox");
        const loginBtn = document.getElementById("loginBtn");
        const adminPass = document.getElementById("adminPass");
        const loginMsg = document.getElementById("loginMsg");
        const generateBtn = document.getElementById("generateBtn");
        const durationSelect = document.getElementById("durationSelect");
        const genMsg = document.getElementById("genMsg");
        const generatedKeyText = document.getElementById("generatedKeyText");
        const copyKeyBtn = document.getElementById("copyKeyBtn");
        const keysList = document.getElementById("keysList");

        // Login function
        loginBtn.addEventListener("click", async () => {
            const password = adminPass.value;
            if (!password) {
                loginMsg.textContent = "Please enter password";
                return;
            }

            try {
                const res = await fetch("/api/login", {
                    method: "POST",
                    headers: {"Content-Type": "application/json"},
                    body: JSON.stringify({ password })
                });
                
                const data = await res.json();
                
                if (data.success) {
                    loginBox.classList.add("hidden");
                    panelBox.classList.remove("hidden");
                    loadKeys();
                } else {
                    loginMsg.textContent = data.message || "Wrong password!";
                }
            } catch (error) {
                loginMsg.textContent = "Login failed!";
            }
        });

        // Generate key function
        generateBtn.addEventListener("click", async () => {
            const durationMs = parseInt(durationSelect.value);
            
            try {
                const res = await fetch("/api/keys", {
                    method: "POST",
                    headers: {"Content-Type": "application/json"},
                    body: JSON.stringify({ durationMs })
                });
                
                const key = await res.json();
                generatedKeyText.textContent = key.value;
                genMsg.classList.remove("hidden");
                loadKeys();
            } catch (error) {
                alert("Failed to generate key");
            }
        });

        // Copy key function
        copyKeyBtn.addEventListener("click", () => {
            const key = generatedKeyText.textContent;
            navigator.clipboard.writeText(key).then(() => {
                alert("Key copied to clipboard!");
            });
        });

        // Load keys function
        async function loadKeys() {
            try {
                const res = await fetch("/api/keys");
                const keys = await res.json();
                
                keysList.innerHTML = keys.map(k => `
                    <li class="key-item">
                        <div class="key-info">
                            <code class="key-value">${k.value}</code>
                            <span class="key-expiry">${k.expiresAt ? new Date(k.expiresAt).toLocaleDateString() : "No Expiry"}</span>
                            <span class="key-status ${k.banned ? 'banned' : 'active'}">
                                ${k.banned ? "Banned" : "Active"}
                            </span>
                        </div>
                        ${!k.banned ? `
                        <button class="btn-secondary btn-small" onclick="banKey('${k.value}')">
                            <i class="fas fa-ban"></i>
                            Ban
                        </button>
                        ` : ''}
                    </li>
                `).join("");
            } catch (error) {
                console.error("Failed to load keys:", error);
            }
        }

        // Ban key function
        async function banKey(keyValue) {
            if (!confirm("Are you sure you want to ban this key?")) return;

            try {
                const res = await fetch("/api/ban", {
                    method: "POST",
                    headers: {"Content-Type": "application/json"},
                    body: JSON.stringify({ value: keyValue })
                });
                
                const data = await res.json();
                
                if (data.success) {
                    loadKeys();
                } else {
                    alert("Failed to ban key");
                }
            } catch (error) {
                alert("Failed to ban key");
            }
        }

        // Navigation
        function showSection(section) {
            // Здесь можно добавить логику для других секций
            console.log("Showing section:", section);
        }

        function logout() {
            localStorage.removeItem("eclipse_auth");
            window.location.reload();
        }

        // Check if already logged in
        if (localStorage.getItem("eclipse_auth")) {
            loginBox.classList.add("hidden");
            panelBox.classList.remove("hidden");
            loadKeys();
        }

        // Enter key to login
        adminPass.addEventListener("keypress", (e) => {
            if (e.key === "Enter") {
                loginBtn.click();
            }
        });
    </script>
</body>
</html>
